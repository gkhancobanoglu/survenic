{#
    This file renders language changer inside the main container when multiple survey languages are available.

    It uses the Yii helper CHtml::dropDownList().
    @see: http://www.yiiframework.com/wiki/48/by-example-chtml/#hh5

#}

{% if aSurveyInfo.alanguageChanger.show == true %}
    
    {# set a shortcut for aSurveyInfo.alanguageChanger.datas #}
    {% set aLCD  = aSurveyInfo.alanguageChanger.datas %}

    {#
        array of attributes of the Drop Down list.
        To add a new attribute, just add an entry:
        'attribute' : 'value',
    #}
    {% set htmlOptions = {
            'class'          : 'form-control',
            'data-targeturl' : aLCD.targetUrl,
        }
    %}
    <!-- Language Changer -->
    <div class="{{ aSurveyInfo.class.formgroup }} form-change-lang row row-cols-lg-auto g-1 modern-lang-changer-container" {{ aSurveyInfo.attr.formgroup }} >
        <label class="{{ aSurveyInfo.class.controllabel }} col-form-label col-auto fw-bold modern-lang-changer-label" {{ aSurveyInfo.attr.controllabel }} for="lang">
            <span class="control-label" {{ aSurveyInfo.attr.languagechanger }}>{{ gT("Language:") }}</span>
        </label>
        <div class="col-auto modern-lang-changer-selectcol">
                {{
                    C.Html.dropDownList(
                        'lang',
                        aLCD.sSelected,
                        aLCD.aListLang,
                        htmlOptions|merge({'class':'form-select modern-lang-changer-select', 'id':'lang'})
                    )
                }}
        </div>
        <div class="col-auto modern-lang-changer-btncol">
        <!-- for no js functionality (need form) -->
        {% set buttonhtmlOptions = {
                'type'          : 'submit',
                'value'         : 'changelang',
                'name'          : 'move',
                'class'         : 'btn modern-lang-changer-btn',
            }
        %}
        {{
            C.Html.htmlButton(
                gT("Change the language"),
                buttonhtmlOptions
            )
        }}
        </div>
        <div class="modern-lang-changer-loader" id="modern-lang-changer-loader" style="display:none;"></div>
    </div>

    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            var select = document.getElementById('lang');
            if(select) {
                select.addEventListener('change', function() {
                    var loader = document.getElementById('modern-lang-changer-loader');
                    if(loader) {
                        loader.style.display = 'inline-block';
                        setTimeout(function(){ loader.style.display = 'none'; }, 1200);
                    }
                });
            }
        });
    </script>

    <style>
        .modern-lang-changer-container {
            align-items: center;
            margin: 1.2rem 0 1.2rem 0;
            gap: 0.5rem;
        }
        .modern-lang-changer-label {
            font-size: 1.01rem;
            color: #1e3a8a;
            font-weight: 600;
            margin-right: 0.5rem;
        }
        .modern-lang-changer-selectcol {
            min-width: 120px;
        }
        .modern-lang-changer-select {
            font-size: 0.98rem;
            border-radius: 7px;
            border: 1.5px solid #dbeafe;
            background: #fff;
            color: #2563eb;
            font-weight: 500;
            padding: 0.38rem 1.1rem 0.38rem 0.7rem;
            transition: border 0.16s, box-shadow 0.16s;
            box-shadow: none;
            outline: none;
            min-width: 120px;
        }
        .modern-lang-changer-select:focus {
            border: 1.5px solid #0d6efd;
            box-shadow: 0 0 0 2px #0d6efd22;
        }
        .modern-lang-changer-select option {
            font-size: 0.98rem;
            color: #222;
        }
        .modern-lang-changer-select option:checked {
            background: #e9f5ff;
            color: #0d6efd;
            font-weight: 600;
        }
        .modern-lang-changer-btncol {
            margin-left: 0.5rem;
        }
        .modern-lang-changer-btn {
            font-size: 0.97rem;
            font-weight: 500;
            border-radius: 6px;
            padding: 0.38rem 1.05rem;
            background: #2563eb;
            color: #fff;
            border: none;
            transition: background 0.16s, color 0.16s;
            outline: none;
            box-shadow: none;
        }
        .modern-lang-changer-btn:hover, .modern-lang-changer-btn:focus {
            background: #0d6efd;
            color: #fff;
        }
        .modern-lang-changer-loader {
            display: inline-block;
            width: 22px;
            height: 22px;
            border: 2.5px solid #dbeafe;
            border-top: 2.5px solid #2563eb;
            border-radius: 50%;
            animation: modernLangSpin 0.7s linear infinite;
            margin-left: 0.7rem;
            vertical-align: middle;
        }
        @keyframes modernLangSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 600px) {
            .modern-lang-changer-container {
                flex-direction: column;
                align-items: stretch;
                gap: 0.7rem;
            }
            .modern-lang-changer-label {
                margin-bottom: 0.2rem;
            }
            .modern-lang-changer-btncol {
                margin-left: 0;
            }
            .modern-lang-changer-select {
                width: 100%;
            }
        }
    </style>
    
    {# Activate the language changer  #}
    {{ registerScript("activateLanguageChanger", "activateLanguageChanger(); ", "POS_END") }}
    
{% endif %}
