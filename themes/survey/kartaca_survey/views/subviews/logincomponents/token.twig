{% extends "./subviews/logincomponents/captcha.twig" %}

    {% block formheading %}
        <div class="token-form-heading">{{ gT("To participate in this restricted survey, you need a valid access code.") }}</div>
    {% endblock %}

    {% block description %}
        <div class="col-lg-8 offset-lg-2">
            <p class='{{ aSurveyInfo.class.maincoldivdivbp }} text-info' {{ aSurveyInfo.attr.maincoldivdivbp }}>
                {% if aSurveyInfo.aForm.token == null %}
                    {{ gT("If you have been issued an access code, please enter it in the box below and click continue.") }}
                {% else %}
                    {{ gT("Please confirm the access code by answering the security question below and click continue.") }}
                {% endif %}
            </p>
        </div>
    {% endblock %}

    {% block formcontent %}
        <div class="col-lg-8 offset-lg-2">
            <div class='{{ aSurveyInfo.class.maincolform }} mb-3 token-form-card' {{ aSurveyInfo.attr.maincolform }}>
                <label
                    class='{{ aSurveyInfo.class.maincolformlabel }} control-label col-md-3 token-label' {{ aSurveyInfo.attr.maincolformlabel }}>
                    <small
                        class="{{ aSurveyInfo.class.maincolformlabelsmall }} text-danger asterisk fa fa-asterisk small " {{ aSurveyInfo.attr.maincolformlabelsmall }} ></small>
                    {{ gT("Access code:") }}
                    <span
                        class="{{ aSurveyInfo.class.maincolformlabelspan }} visually-hidden text-danger asterisk " {{ aSurveyInfo.attr.maincolformlabelspan }}>
                    ( {{ gT("Mandatory") }} )
                </span>
                </label>

                <div class='{{ aSurveyInfo.class.maincolformdiva }}' {{ aSurveyInfo.attr.maincolformdiva }}>
                    {% if aSurveyInfo.aForm.token == null %}
                        <div class='input-group token-input-group'>
                            <input
                                class='{{ aSurveyInfo.class.maincolformdivainput }} form-control token-input' {{ aSurveyInfo.attr.maincolformdivainput }} >
                            <button type="button" class="input-group-text ls-no-js-hidden token-toggle-btn" id="ls-toggle-token-show" data-passwordstate="hidden">
                                <i class="fa fa-eye ls-password-hidden" aria-hidden="true"></i><span class="visually-hidden ls-password-hidden">gT("Show code")</span>
                                <i class="fa fa-eye-slash d-none ls-password-shown" aria-hidden="true"></i><span class="visually-hidden d-none ls-password-shown">gT("Hide code")</span>
                            </button>
                        </div>
                        <script>
                            $("#ls-toggle-token-show").on('click', function () {
                                if ($(this).data('passwordstate') == "hidden") {
                                    $(this).prev("input").attr('type', 'text');
                                    $(this).find('.ls-password-hidden').addClass('d-none');
                                    $(this).find('.ls-password-shown').removeClass('d-none');
                                    $(this).data('passwordstate', 'shown');
                                } else {
                                    $(this).prev("input").attr('type', 'password');
                                    $(this).find('.ls-password-hidden').removeClass('d-none');
                                    $(this).find('.ls-password-shown').addClass('d-none');
                                    $(this).data('passwordstate', 'hidden');
                                }
                            });
                        </script>
                    {% else %}
                        {# token is OK, captcha not #}
                        {% set passwordFieldHtmlOptions = {
                            'id'       : 'token',
                            'required' : true,
                            'readonly' : true,
                            'class'    : 'form-control token-input'
                        } %}

                        {{ C.Html.passwordField(
                            'token',
                            (( aSurveyInfo.aForm.token )),
                        (passwordFieldHtmlOptions)
                        ) }}
                    {% endif %}
                </div>
            </div>

            {# CAPTACHA INSIDE TOKEN FORM #}
            {% if ( aSurveyInfo.aForm.bCaptchaEnabled == true ) %}
                <div class="{{ aSurveyInfo.class.maincolformdivb }} mb-3 token-form-card" {{ aSurveyInfo.attr.maincolformdivb }}>
                    <label
                        class='{{ aSurveyInfo.class.maincolformdivblabel }} control-label token-label' {{ aSurveyInfo.attr.maincolformdivblabel }} >
                        {{ gT("Please solve the following equation:") }}
                        <small
                            class="{{ aSurveyInfo.class.maincolformdivblabelsmall }} text-danger asterisk fa fa-asterisk float-start small" {{ aSurveyInfo.attr.maincolformdivblabelsmall }} >&nbsp;</small>
                        <span
                            class="{{ aSurveyInfo.class.maincolformdivblabelspan }} visually-hidden text-danger asterisk" {{ aSurveyInfo.attr.maincolformdivblabelspan }}>
                        ( {{ gT("Mandatory") }} )
                    </span>
                    </label>
                    <div class="row">
                        <div class="col-2">
                            {{ renderCaptcha().renderOut() }}
                        </div>
                        <div class="col-1 align-self-center">
                            <a href="#" class="btn btn-sm btn-outline-secondary token-captcha-refresh" id="reloadCaptcha"
                               title="{{ gT("Reload captcha") }}" data-bs-toggle="captcha"><i
                                    class="fa fa-refresh"></i></a>
                        </div>
                        <div
                            class="{{ aSurveyInfo.class.maincolformdivbdiv }} col-9 align-self-center" {{ aSurveyInfo.attr.maincolformdivbdiv }}>
                            <input
                                class='form-control {{ aSurveyInfo.class.maincolformdivbdivdivinput }} token-input' {{ aSurveyInfo.attr.maincolformdivbdivdivinput }} >
                        </div>
                    </div>
                </div>
            {% endif %}

            {{ aSurveyInfo.aForm.hiddenFields }}

            <div class='{{ aSurveyInfo.class.maincolformdivc }} mb-3 ' {{ aSurveyInfo.attr.maincolformdivc }}>
                <div
                    class='{{ aSurveyInfo.class.maincolformdivcdiv }} float-end ' {{ aSurveyInfo.attr.maincolformdivcdiv }}>
                    <button type="submit"
                            class='{{ aSurveyInfo.class.maincolformdivcdivbutton }} btn btn-primary token-submit-btn' {{ aSurveyInfo.attr.maincolformdivcdivbutton }}>
                        {{ gT("Continue") }}
                    </button>
                </div>
            </div>
        </div>
        <style>
        .token-form-heading {
            font-size: 1.25em;
            font-weight: 600;
            color: #295fa6;
            margin-bottom: 1.2em;
            text-align: center;
        }
        .token-form-card {
            background: #f8fafc;
            border-radius: 1.1em;
            box-shadow: 0 2px 12px 0 rgba(34,41,47,0.06);
            padding: 1.5em 1.2em 1.2em 1.2em;
            margin-bottom: 1.2em;
        }
        .token-label {
            font-weight: 500;
            color: #1e4c8a;
            margin-bottom: 0.5em;
        }
        .token-input-group {
            border-radius: 0.6em;
            overflow: hidden;
            box-shadow: 0 1px 4px 0 rgba(34,41,47,0.07);
        }
        .token-input {
            border-radius: 0.6em 0 0 0.6em;
            border: 1px solid #c7d3e0;
            font-size: 1.08em;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .token-input:focus {
            border-color: #295fa6;
            box-shadow: 0 0 0 2px #e4ecf7;
        }
        .token-toggle-btn {
            background: #f4f7fb;
            border: 1px solid #c7d3e0;
            border-left: none;
            border-radius: 0 0.6em 0.6em 0;
            color: #295fa6;
            transition: background 0.2s, color 0.2s;
        }
        .token-toggle-btn:hover, .token-toggle-btn:focus {
            background: #e4ecf7;
            color: #1e4c8a;
        }
        .token-captcha-refresh {
            border-radius: 0.5em;
            color: #295fa6;
            border: 1px solid #c7d3e0;
            background: #f4f7fb;
            transition: background 0.2s, color 0.2s;
        }
        .token-captcha-refresh:hover, .token-captcha-refresh:focus {
            background: #e4ecf7;
            color: #1e4c8a;
        }
        .token-submit-btn {
            border-radius: 0.7em;
            font-weight: 600;
            padding: 0.6em 2.2em;
            font-size: 1.08em;
            background: linear-gradient(90deg, #295fa6 0%, #4e8edb 100%);
            border: none;
            color: #fff;
            box-shadow: 0 2px 8px 0 rgba(34,41,47,0.07);
            transition: background 0.2s, box-shadow 0.2s;
        }
        .token-submit-btn:hover, .token-submit-btn:focus {
            background: linear-gradient(90deg, #1e4c8a 0%, #295fa6 100%);
            box-shadow: 0 4px 16px 0 rgba(34,41,47,0.10);
            color: #fff;
        }
        </style>
    {% endblock %}
